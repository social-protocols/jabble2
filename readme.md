# Jabble

Collaborative Fact Checking. This is a work in progress.

## Getting Started

1. Setup on your system:

   - [devbox](https://www.jetpack.io/devbox)
   - [direnv](https://direnv.net/)

   ```bash
   # to enter the devbox dev shell loaded by direnv
   direnv allow
   ```

1. Run the development stack

   ```bash
   just dev
   ```

1. Point your browser to <http://localhost:12345>
1. List other useful commands by typing
   ```bash
   just
   ```

## Key Technologies

### Stack & Development

- [devbox](https://www.jetpack.io/devbox) and [nix flakes](https://zero-to-nix.com/concepts/flakes) for a reproducible dev environment: [devbox.json](devbox.json)
- [direnv](https://direnv.net/) to automatically load dev environment when entering project directory: [.envrc](.envrc)
- [just](https://github.com/casey/just) runner for common commands used in development: [justfile](justfile)
- [process-compose](https://github.com/F1bonacc1/process-compose) process orchestrator used for dev environment ([process-compose.yml](process-compose.yml)) and prod environment ([process-compose-prod.yml](process-compose-prod.yml))
- [earthly](https://docs.earthly.dev/) Dockerfile-like CI with very good caching, locally runnable: [Earthfile](Earthfile)
- [fly.io](https://fly.io/) simple cloud hosting provider: [fly.toml](fly.toml), deployment happens via [Earthfile](Earthfile) in a GitHub Action [.github/workflows/deploy.yml](.github/workflows/deploy.yml)
- [Keratin Authn](https://keratin.github.io/) with [keratin-authn-scala](https://github.com/cornerman/keratin-authn-scala), simple self-hosted authentication service, deployed alongside the backend using [process-compose-prod.yml](process-compose-prod.yml)
- [Scala 3](https://www.scala-lang.org/) programming language, compiled to javascript using [ScalaJS](https://www.scala-js.org/), used for [frontend](frontend/src/frontend/) and [backend](backend/src/backend/)
- [Mill](https://mill-build.com) build tool for Scala: [build.sc](build.sc)
- [sloth](https://github.com/cornerman/sloth) Type safe RPC calls for Scala: [RpcApi.scala](rpc/src/rpc/RpcApi.scala), [RpcApiImpl.scala](backend/src/backend/RpcApiImpl.scala), [RpcClient.scala](frontend/src/frontend/RpcClient.scala), [HttpServer.scala](backend/src/backend/HttpServer.scala)
- [smithy](https://smithy.io) with [smithy4s](https://disneystreaming.github.io/smithy4s/) for http api code generation
- [Outwatch](https://github.com/outwatch/outwatch/) web-frontend library for ScalaJS: Entrypoint in [FrontendMain.scala](frontend/src/frontend/FrontendMain.scala)
- [Shoelace](https://shoelace.style/) web components, with outwatch types generated by [scala-web-components-codegen](https://github.com/cornerman/scala-web-components-codegen), configured in [build.sc](build.sc)
- [Vite](https://vitejs.dev) hot reloading and bundling: [vite.config.mts](vite.config.mts), [main.js](main.js), [index.html](index.html)
- [TailwindCSS](https://tailwindcss.com/) CSS Framework with lots of utility classes: [tailwind.onfig.js](tailwind.config.js), [postcss.config.js](postcss.config.js)
- [Mergify](https://docs.mergify.com/) for automatic PR merging with a merge queue: [.mergify.yml](.mergify.yml)
- [Bun](https://bun.sh/docs) for fast npm installs ([package.json](package.json)), used in [process-compose.yml](process-compose.yml) and [Earthfile](Earthfile)
- [entr](https://github.com/eradman/entr) Run arbitrary commands when files change, used for development reloading in [process-compose.yml](process-compose.yml) and [justfile](justfile)
- [wrk](https://github.com/wg/wrk) for http benchmarking: [wrk/](wrk) (`just benchmark <name>`)

### Database

- [SQLite](https://www.sqlite.org/) lightweight, fast single-file relational database
- [magnum](https://github.com/AugustNagro/magnum), JDBC library for Scala 3
- [HikariCP](https://github.com/brettwooldridge/HikariCP) fast JDBC connection pool, configured in [AppConfig.scala](backend/src/backend/AppConfig.scala)
- [scala-db-codegen](https://github.com/cornerman/scala-db-codegen) using [SchemaCrawler](https://www.schemacrawler.com/) to read [schema.sql](schema.sql) and generate schema types for magnum. Template [schema.scala.ssp](schema.scala.ssp), config in [build.sc](build.sc)
- [flyway](https://flywaydb.org/) for Database Migrations
- [Atlas](https://atlasgo.io/docs) generate SQL migrations by diffing [schema.sql](schema.sql) against [migrations](backend/resources/migrations/) (`just new-migration <name>`) or the current dev-database (`just migrate-dev`).
- [sqlc](https://docs.sqlc.dev/en/latest/) with [sqlc-gen-from-template](https://github.com/fdietze/sqlc-gen-from-template) to generate type-safe functions for every query in [queries.sql](queries.sql) into [Queries.scala](backend/src/backend/queries/Queries.scala) using a template [queries_template.go.tmpl](queries_template.go.tmpl). Config in [sqlc.yml](sqlc.yml), `just generate-query-code`
